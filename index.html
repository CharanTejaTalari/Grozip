<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grozip - Premium Grocery Shopping</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    #map { height: 100%; }
    .leaflet-container { border-radius: 0.75rem; }
    .autocomplete-suggestions {
      position: absolute;
      background: white;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      border-radius: 0.5rem;
      z-index: 1000;
    }
    .autocomplete-suggestion {
      padding: 0.75rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .autocomplete-suggestion:hover {
      background-color: #f3f4f6;
    }
    .dark .autocomplete-suggestions {
      background: #1f2937;
      color: #f9fafb;
    }
    .dark .autocomplete-suggestion:hover {
      background-color: #374151;
    }
    .animate-slide-in {
      animation: slideIn 0.5s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .dark { background: #111827; color: #f9fafb; }
    .dark .bg-white { background: #1f2937; }
    .dark .text-gray-600 { color: #d1d5db; }
    .dark .bg-gray-100 { background: #374151; }
    .dark .text-green-600 { color: #10b981; }
    .dark .bg-green-600 { background: #059669; }
    .dark .bg-green-700 { background: #047857; }
    .dark .text-gray-800 { color: #f3f4f6; }
    .sidebar {
      width: 250px;
      position: fixed;
      top: 80px; /* Adjust for header height */
      bottom: 0;
      left: 0;
      overflow-y: auto;
      border-right: 1px solid #e5e7eb;
    }
    .sidebar-item {
      padding: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .sidebar-item:hover {
      background-color: #f3f4f6;
    }
    .sidebar-item.active {
      background-color: #e5e7eb;
      font-weight: bold;
      color: #059669;
    }
    .dark .sidebar {
      border-right: 1px solid #374151;
    }
    .dark .sidebar-item:hover {
      background-color: #374151;
    }
    .dark .sidebar-item.active {
      background-color: #4b5563;
      color: #10b981;
    }
  </style>
</head>
<body className="transition-colors duration-300">
  <div id="root"></div>

  <!-- Load component scripts -->
  <script src="data.js"></script>
  <script src="Header.js" type="text/babel"></script>
  <script src="Login.js" type="text/babel"></script>
  <script src="Signup.js" type="text/babel"></script>
  <script src="Home.js" type="text/babel"></script>
  <script src="StoreList.js" type="text/babel"></script>
  <script src="Groceries.js" type="text/babel"></script>
  <script src="Cart.js" type="text/babel"></script>
  <script src="Payment.js" type="text/babel"></script>
  <script src="CustomerPortal.js" type="text/babel"></script>
  <script src="StorePortal.js" type="text/babel"></script>
  <script src="Footer.js" type="text/babel"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Authentication Context
    const AuthContext = React.createContext();

    // Main App Component
    const App = () => {
      const [page, setPage] = useState('home');
      const [selectedStore, setSelectedStore] = useState(null);
      const [isDark, setIsDark] = useState(false);
      const [user, setUser] = useState(null);
      const [search, setSearch] = useState('');

      const toggleTheme = () => {
        setIsDark(!isDark);
        document.body.classList.toggle('dark');
      };

      const login = (userData) => {
        setUser(userData);
        localStorage.setItem('user', JSON.stringify(userData));
      };

      const logout = () => {
        setUser(null);
        localStorage.removeItem('user');
      };

      const handleSetPage = (newPage, newSearch = search) => {
        setPage(newPage);
        setSearch(newSearch);
      };

      useEffect(() => {
        try {
          const savedUser = localStorage.getItem('user');
          if (savedUser) {
            const parsedUser = JSON.parse(savedUser);
            setUser(parsedUser);
            if (parsedUser.role === 'customer') {
              setPage('customer_portal');
            } else if (parsedUser.role === 'store') {
              setPage('store_portal');
            }
          }
        } catch {
          localStorage.removeItem('user');
        }
      }, []);

      return (
        <AuthContext.Provider value={{ user, login, logout }}>
          <div className={`min-h-screen flex flex-col ${isDark ? 'dark' : ''}`}>
            <Header setPage={handleSetPage} toggleTheme={toggleTheme} isDark={isDark} />
            {page === 'home' && <Home setPage={handleSetPage} />}
            {page === 'store_list' && <StoreList setPage={handleSetPage} setSelectedStore={setSelectedStore} search={search} />}
            {page === 'groceries' && <Groceries setPage={handleSetPage} selectedStore={selectedStore} />}
            {page === 'cart' && <Cart setPage={handleSetPage} />}
            {page === 'payment' && <Payment setPage={handleSetPage} />}
            {page === 'login' && <Login setPage={handleSetPage} login={login} />}
            {page === 'signup' && <Signup setPage={handleSetPage} login={login} />}
            {page === 'customer_portal' && <CustomerPortal setPage={handleSetPage} />}
            {page === 'store_portal' && <StorePortal setPage={handleSetPage} />}
            <Footer />
          </div>
        </AuthContext.Provider>
      );
    };

    // Render the app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>